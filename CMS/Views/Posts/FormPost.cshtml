@model CMS.Models.Post

@{
    ViewBag.Title = "Form Post";
    Layout = "~/Views/Shared/_Editor.cshtml";
}


<input type="hidden" class="form-control" id="postId" value="@Model.Id">

<div class="box box-primary">
    <div class="box-header with-border">
        <h3 class="box-title">Post</h3>
    </div>
    <!-- /.box-header -->
    <div class="box-body">
        <div class="form-group">
            <input class="form-control" id="postTitle" placeholder="Post Title" value="@Model.PostTitle">
        </div>
        <div class="form-group">
            <input class="form-control" id="postSummary" placeholder="Post Summary" value="@Model.PostSummary">
        </div>

        <div class="form-group">
            <input class="form-control" id="postSEO" placeholder="Post SEO"  value="@Model.PostSEO">
        </div>

        <div class="form-group">
            
            <div class="editable">@Html.Raw(Model.PostContent)</div>

        </div>

    </div>
    <!-- /.box-body -->
    <div class="box-footer">
        <div class="pull-right">
            <button type="button" class="btn btn-default"><i class="fa fa-pencil"></i> Draft</button>
            <button id="save" class="btn btn-primary"><i class="fa fa-save"></i> Save</button>
        </div>
        <button type="reset" class="btn btn-default"><i class="fa fa-times"></i> Discard</button>
    </div>
    <!-- /.box-footer -->
</div>






<script>

        var editor = new MediumEditor('.editable');

        editor.subscribe('editableInput', function (eventObj, editable) {

            var content = editor.getContent(); // getContent() returns the content of the editor as well
            //console.log("content", content);

        });

        $(document).on("click", "#save", function (e) {

            var postId = $("#postId").val();
            var postTitle = $("#postTitle").val();
            var postSummary = $("#postSummary").val();
            var postSEO = $("#postSEO").val();
            var _content = editor.getContent();

            var _request_type = "POST";
            var _params = ""
            

            var _data = {
                PostContent: _content,
                PostSEO: postSEO,
                PostSummary: postSummary,
                PostTitle: postTitle
            }

            if (postId && postId != 0) {
                var _request_type = "PUT";
                _data.Id = postId;
                _params = "/" + postId;
            }

            $.ajax({
                type: _request_type,
                url: '@Url.Content("~/API/Posts")' + _params,
                data: _data,
                success: function (retorno) {
                    window.location.href = '@Url.Content("~/Posts/Edit/")' + retorno.id;
                }
            });

        });



</script>
